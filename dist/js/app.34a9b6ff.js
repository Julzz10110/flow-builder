(function(){"use strict";var e={4948:function(e,l,a){var t=a(5130),n=(a(4114),a(8111),a(2489),a(116),a(3579),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(6768)),o=a(4232),u=a(144),d=a(6805),i=(a(99),a(4963)),r=a(1307),c=a.n(r);const s={class:"header-container"},v={class:"pipeline-settings"},p={class:"settings-row"},f={class:"setting-group"},b={class:"setting-group"},k={key:0,class:"dagu-section"},g=["disabled"],y={key:0,class:"yaml-preview"},m={key:0,class:"hint-tooltip"},h={class:"controls"},w=["disabled"],L=["disabled"],C={key:0},x={key:1};var E=(0,n.pM)({__name:"App",setup(e){const l=(0,u.KR)("my_flow"),a=(0,u.KR)("My flow's desciption."),r=(0,u.KR)(""),E=(0,u.KR)([{id:"start",type:"input",data:{label:"start",command:"",processFunction:async()=>{console.log("start"),await M(1e3)}},position:{x:50,y:50},sourcePosition:d.yX.Bottom,style:{backgroundColor:"#d0d0d0",color:"black",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!1,deletable:!1},{id:"end",type:"output",data:{label:"end",command:"",processFunction:async()=>{console.log("end"),await M(1e3)}},position:{x:500,y:400},sourcePosition:d.yX.Top,style:{backgroundColor:"#454545",color:"white",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!1,deletable:!1}]),{removeEdges:R,addNodes:K,updateNode:O,removeNodes:X,getEdges:U}=(0,d.Id)(),_=(0,u.KR)(!1),F=(0,u.KR)(!1),j=(0,u.KR)(null),P=(0,u.KR)(null),V=(0,u.KR)(null),$=(0,u.KR)(!1),A=(0,u.KR)(null),Q=(0,u.KR)(!1),T=(0,n.EW)(()=>{let e=0,l="start";while("end"!==l){const a=ie(l);if(!a||"end"===a)break;e++,l=a}return e}),M=e=>new Promise(l=>setTimeout(l,e)),I=e=>"start"===e||"end"===e,N=(0,n.EW)(()=>{const e=new Set;let l="start";while(l&&"end"!==l){if(e.has(l))return!1;e.add(l);const a=U.value.filter(e=>e.source===l);if(1!==a.length)return!1;l=a[0].target}return"end"===l}),W=e=>"input"===e.type?"input-node":"output"===e.type?"output-node":"default-node",B=({pane:e})=>{e&&(e.tabIndex=0,e.focus())},D=e=>{!e.ctrlKey&&!e.metaKey||"x"!==e.key&&"ч"!==e.key||(e.preventDefault(),J(),le()),!e.ctrlKey&&!e.metaKey||"a"!==e.key&&"ф"!==e.key||(e.preventDefault(),S())},J=()=>{if(!P.value||I(P.value.id))return void console.warn("Нет выбранной ноды для удаления или нода защищена");console.log("Удаление ноды:",P.value.id);const e=P.value.id,l=U.value.filter(l=>l.source===e||l.target===e);console.log("Связанные edges для удаления:",l),l.length>0&&(console.log("Удаление edges"),R(l)),console.log("Удаление ноды"),X([e]),E.value=E.value.filter(a=>a.id!==e&&!l.some(e=>e.id===a.id)),P.value=null,ae(),console.log("Удаление завершено, текущие элементы:",E.value)},S=()=>{const e=(0,i.A)(),l={id:e,data:{label:`Шаг ${T.value+1}`,command:"",processFunction:async()=>{console.log(`Выполняется шаг ${e}`),await M(1e3)}},position:{x:100+100*T.value,y:150},targetPosition:d.yX.Top,sourcePosition:d.yX.Bottom,style:{backgroundColor:"#2196F3",color:"white",borderRadius:"50%",width:"80px",height:"80px"}};E.value.push(l),K([l])},Y=e=>{const l={id:`edge-${e.source}-${e.target}`,source:e.source,target:e.target};E.value=(0,d.rN)(l,E.value),$.value=!1,ae()},G=e=>{$.value||I(e.node.id)||(P.value=e.node,V.value=null)},q=e=>{console.log("Edge click event",e),P.value=null,V.value=e.edge},z=(e,l)=>{console.log("TEST edge",l),e.preventDefault()},H=(e,l)=>{console.log("onUpdateEdge",l)},Z=()=>{P.value&&!I(P.value.id)&&O(P.value.id,{...P.value,data:{...P.value.data,label:P.value.data.label}})},ee=()=>{P.value&&!I(P.value.id)&&O(P.value.id,{...P.value,data:{...P.value.data,command:P.value.data.command}})},le=()=>{V.value&&(R([V.value]),E.value=E.value.filter(e=>e.id!==V.value?.id),V.value=null,ae())},ae=()=>{let e=1,l="start";while("end"!==l){const a=ie(l);if(!a||"end"===a)break;const t=E.value.find(e=>e.id===a);t&&!I(t.id)&&(t.data.label=`Шаг ${e}`,O(t.id,t),e++),l=a}},te=async()=>{_.value=!0,F.value=!1,j.value="start";try{await de("start");let e=ie("start");while(e&&_.value)j.value=e,await de(e),e=ie(e);_.value&&(j.value="end",await de("end"))}catch(e){console.error("Ошибка выполнения графа:",e)}finally{_.value=!1,j.value=null}},ne=()=>{_.value=!1,F.value=!0},oe=async()=>{if(j.value){F.value=!1,_.value=!0;try{let e=ie(j.value);while(e&&_.value)j.value=e,await de(e),e=ie(e);_.value&&(j.value="end",await de("end"))}catch(e){console.error("Ошибка выполнения графа:",e)}finally{_.value=!1,F.value=!1,j.value=null}}},ue=()=>{_.value=!1,F.value=!1,j.value=null},de=async e=>{const l=E.value.find(l=>l.id===e);l&&l.data&&l.data.processFunction&&(console.log(`Запуск шага: ${l.data.label}`),await l.data.processFunction(),console.log(`Шаг завершен: ${l.data.label}`))},ie=e=>{const l=E.value.filter(l=>l.source===e&&l.target);return l.length>0?l[0].target:null},re=()=>{const e=[];let t="start";while("end"!==t){const l=ie(t);if(!l||"end"===l)break;const a=E.value.find(e=>e.id===l);a&&!I(a.id)&&e.push({name:a.data.label,command:a.data.command}),t=l}const n={name:l.value,description:a.value,steps:e};r.value=c().stringify(n)},ce=()=>{if(!r.value)return;const e=new Blob([r.value],{type:"application/yaml"}),a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download=`${l.value}.yaml`.replace(/\s+/g,"_"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)};return(0,n.sV)(()=>{A.value&&A.value.focus()}),(e,i)=>((0,n.uX)(),(0,n.CE)("div",{class:"flow-container",tabindex:"0",onKeydown:D},[(0,n.Lk)("div",s,[i[12]||(i[12]=(0,n.Lk)("div",null,[(0,n.Lk)("h1",null,"Flow Builder"),(0,n.Lk)("p",null,"Постройте свой пайплайн процессов")],-1)),(0,n.Lk)("div",v,[i[8]||(i[8]=(0,n.Lk)("h3",null,"Настройки пайплайна",-1)),(0,n.Lk)("div",p,[(0,n.Lk)("div",f,[i[6]||(i[6]=(0,n.Lk)("label",{for:"flow-name"},"Название:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",id:"flow-name","onUpdate:modelValue":i[0]||(i[0]=e=>l.value=e),placeholder:"Введите название"},null,512),[[t.Jo,l.value]])]),(0,n.Lk)("div",b,[i[7]||(i[7]=(0,n.Lk)("label",{for:"flow-description"},"Описание:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",id:"flow-description","onUpdate:modelValue":i[1]||(i[1]=e=>a.value=e),placeholder:"Введите описание"},null,512),[[t.Jo,a.value]])])])]),N.value?((0,n.uX)(),(0,n.CE)("div",k,[i[9]||(i[9]=(0,n.Lk)("h3",null,"Конфигурация DAGU",-1)),(0,n.Lk)("button",{onClick:re},"Показать YAML"),(0,n.Lk)("button",{onClick:ce,disabled:!r.value},"Загрузить YAML",8,g),r.value?((0,n.uX)(),(0,n.CE)("pre",y,(0,o.v_)(r.value),1)):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0),(0,n.Lk)("button",{class:"hint-button",onClick:i[2]||(i[2]=e=>Q.value=!Q.value)},[i[11]||(i[11]=(0,n.Lk)("span",null,"?",-1)),Q.value?((0,n.uX)(),(0,n.CE)("div",m,i[10]||(i[10]=[(0,n.Lk)("p",null,[(0,n.Lk)("strong",null,"Ctrl+A"),(0,n.eW)(" - Добавить новый шаг")],-1),(0,n.Lk)("p",null,[(0,n.Lk)("strong",null,"Ctrl+X"),(0,n.eW)(" - Удалить выбранный шаг или связь")],-1)]))):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",h,[(0,n.Lk)("button",{onClick:S},"Добавить шаг"),(0,n.Lk)("button",{onClick:te,disabled:!N.value||_.value},"Запустить",8,w),(0,n.Lk)("button",{onClick:ne,disabled:!_.value||F.value},"Стоп",8,L),F.value?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:oe},"Продолжить")):(0,n.Q3)("",!0),F.value?((0,n.uX)(),(0,n.CE)("button",{key:1,onClick:ue},"Сброс")):(0,n.Q3)("",!0)]),P.value&&!I(P.value.id)?((0,n.uX)(),(0,n.CE)("div",C,[i[13]||(i[13]=(0,n.Lk)("h3",null,"Настройки шага",-1)),i[14]||(i[14]=(0,n.Lk)("label",{for:"node-label"},"Название шага:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",id:"node-label","onUpdate:modelValue":i[3]||(i[3]=e=>P.value.data.label=e),onInput:Z},null,544),[[t.Jo,P.value.data.label]]),i[15]||(i[15]=(0,n.Lk)("label",{style:{"padding-left":"20px"},for:"node-command"},"Команда:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",id:"node-command","onUpdate:modelValue":i[4]||(i[4]=e=>P.value.data.command=e),onInput:ee},null,544),[[t.Jo,P.value.data.command]])])):(0,n.Q3)("",!0),V.value?((0,n.uX)(),(0,n.CE)("div",x,[i[16]||(i[16]=(0,n.Lk)("h3",null,"Настройки связи",-1)),(0,n.Lk)("button",{onClick:le},"Удалить связь")])):(0,n.Q3)("",!0),i[17]||(i[17]=(0,n.Lk)("br",null,null,-1)),(0,n.Lk)("div",{class:"flow-wrapper",ref_key:"flowWrapper",ref:A},[(0,n.bF)((0,u.R1)(d.nO),{modelValue:E.value,"onUpdate:modelValue":i[5]||(i[5]=e=>E.value=e),style:{width:"100%",height:"500px",background:"#fcfcfc"},onNodeClick:G,onEdgeClick:q,onUpdateEdge:H,onEdgeContextMenu:z,"connection-mode":$.value,onConnect:Y,onPaneReady:B,"node-class":W},null,8,["modelValue","connection-mode"])],512)],32))}}),R=a(1241);const K=(0,R.A)(E,[["__scopeId","data-v-738aa876"]]);var O=K;(0,t.Ef)(O).mount("#app")}},l={};function a(t){var n=l[t];if(void 0!==n)return n.exports;var o=l[t]={exports:{}};return e[t].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(l,t,n,o){if(!t){var u=1/0;for(c=0;c<e.length;c++){t=e[c][0],n=e[c][1],o=e[c][2];for(var d=!0,i=0;i<t.length;i++)(!1&o||u>=o)&&Object.keys(a.O).every(function(e){return a.O[e](t[i])})?t.splice(i--,1):(d=!1,o<u&&(u=o));if(d){e.splice(c--,1);var r=n();void 0!==r&&(l=r)}}return l}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[t,n,o]}}(),function(){a.n=function(e){var l=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(l,{a:l}),l}}(),function(){a.d=function(e,l){for(var t in l)a.o(l,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:l[t]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)}}(),function(){var e={524:0};a.O.j=function(l){return 0===e[l]};var l=function(l,t){var n,o,u=t[0],d=t[1],i=t[2],r=0;if(u.some(function(l){return 0!==e[l]})){for(n in d)a.o(d,n)&&(a.m[n]=d[n]);if(i)var c=i(a)}for(l&&l(t);r<u.length;r++)o=u[r],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},t=self["webpackChunkflow_builder"]=self["webpackChunkflow_builder"]||[];t.forEach(l.bind(null,0)),t.push=l.bind(null,t.push.bind(t))}();var t=a.O(void 0,[504],function(){return a(4948)});t=a.O(t)})();
//# sourceMappingURL=app.34a9b6ff.js.map