(function(){"use strict";var e={2607:function(e,l,a){var t=a(5130),n=a(6768),o=a(144),u=(a(4114),a(8111),a(2489),a(116),a(7588),a(8237),a(3579),a(6805)),r=(a(99),a(4963)),i=a(8096),d=(a(1701),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4232)),s=a(7387),c=a(7671),p=a(3109),v=a(6921),f=a(1389),b=a(7966),y=a(2517),m=a(8911),g=a(5045),h=a(4390),_=a(605),k=a(7430),R=a(4428),w=a(1307),A=a.n(w);const F={question:[{d:"M8 2C6.346 2 5 3.346 5 5a.75.75 0 0 0 1.5 0c0-.826.674-1.5 1.5-1.5s1.5.674 1.5 1.5c0 .653-.122 1.018-.254 1.25c-.137.242-.321.41-.601.643l-.051.042c-.26.215-.612.507-.88.939c-.3.483-.464 1.08-.464 1.876v.5a.75.75 0 0 0 1.5 0v-.5c0-.579.116-.888.239-1.085c.136-.219.316-.37.616-.62c.283-.236.66-.553.945-1.053c.29-.51.45-1.145.45-1.992c0-1.654-1.346-3-3-3zm0 12.25a1 1 0 1 0 0-2a1 1 0 0 0 0 2z",fill:"currentColor"}],settings:[{d:"M2.267 6.153A5.986 5.986 0 0 1 3.53 3.98a.355.355 0 0 1 .382-.095l1.36.484a.71.71 0 0 0 .935-.538l.26-1.416a.354.354 0 0 1 .274-.282a6.072 6.072 0 0 1 2.52 0c.14.03.248.141.274.282l.26 1.416a.708.708 0 0 0 .935.538l1.36-.484a.355.355 0 0 1 .382.095c.569.627 1 1.367 1.262 2.173a.352.352 0 0 1-.108.378l-1.102.931a.703.703 0 0 0 0 1.076l1.102.931c.11.093.152.242.108.378a5.985 5.985 0 0 1-1.262 2.173a.355.355 0 0 1-.382.095l-1.36-.484a.71.71 0 0 0-.935.538l-.26 1.416a.353.353 0 0 1-.275.282a6.068 6.068 0 0 1-2.519 0a.354.354 0 0 1-.275-.282l-.259-1.416a.708.708 0 0 0-.935-.538l-1.36.484a.355.355 0 0 1-.382-.095a5.986 5.986 0 0 1-1.262-2.173a.352.352 0 0 1 .108-.378l1.102-.931a.704.704 0 0 0 0-1.076l-1.102-.931a.352.352 0 0 1-.108-.378zM6.25 8a1.75 1.75 0 1 0 3.5 0a1.75 1.75 0 0 0-3.5 0z",fill:"currentColor"}],plus:[{d:"M8.5 2.75a.75.75 0 0 0-1.5 0V7H2.75a.75.75 0 0 0 0 1.5H7v4.25a.75.75 0 0 0 1.5 0V8.5h4.25a.75.75 0 0 0 0-1.5H8.5V2.75z",fill:"currentColor"}],play:[{d:"M6.235 2.192A1.5 1.5 0 0 0 4 3.499v9a1.5 1.5 0 0 0 2.235 1.308l8-4.5a1.5 1.5 0 0 0 0-2.615l-8-4.5z",fill:"currentColor"}],pause:[{d:"M3.5 2A1.5 1.5 0 0 0 2 3.5v9A1.5 1.5 0 0 0 3.5 14h2A1.5 1.5 0 0 0 7 12.5v-9A1.5 1.5 0 0 0 5.5 2h-2zm7 0A1.5 1.5 0 0 0 9 3.5v9a1.5 1.5 0 0 0 1.5 1.5h2a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 12.5 2h-2z",fill:"currentColor"}],delete:[{d:"M10 4h3a.5.5 0 0 1 0 1h-.553l-.752 6.776A2.5 2.5 0 0 1 9.21 14H6.79a2.5 2.5 0 0 1-2.485-2.224L3.552 5H3a.5.5 0 0 1 0-1h3a2 2 0 1 1 4 0zM8 3a1 1 0 0 0-1 1h2a1 1 0 0 0-1-1zM6.5 7v4a.5.5 0 0 0 1 0V7a.5.5 0 0 0-1 0zM9 6.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 1 0V7a.5.5 0 0 0-.5-.5z",fill:"currentColor"}],refresh:[{d:"M3 8a5 5 0 0 1 9-3H9.5a.5.5 0 0 0 0 1h3a.5.5 0 0 0 .5-.5v-.657V2.5a.5.5 0 0 0-1 0v1.028A6 6 0 1 0 14 8a.5.5 0 0 0-1 0A5 5 0 0 1 3 8z",fill:"currentColor"}],code:[{d:"M9.803 3.043a.5.5 0 0 1 .254.66l-4 9a.5.5 0 0 1-.914-.406l4-9a.5.5 0 0 1 .66-.254zm-5.47 2.333a.5.5 0 0 1 .04.706L2.67 8l1.705 1.918a.5.5 0 1 1-.748.664l-2-2.25a.5.5 0 0 1 0-.664l2-2.25a.5.5 0 0 1 .706-.042zm7.335 0a.5.5 0 0 1 .706.042l2 2.25a.5.5 0 0 1 0 .664l-2 2.25a.5.5 0 1 1-.748-.664L13.331 8l-1.705-1.918a.5.5 0 0 1 .042-.706z",fill:"currentColor"}],download:[{d:"M3.5 13h9a.75.75 0 0 1 .102 1.493l-.102.007h-9a.75.75 0 0 1-.102-1.493L3.5 13h9h-9zM7.898 1.007L8 1a.75.75 0 0 1 .743.648l.007.102v7.688l2.255-2.254a.75.75 0 0 1 .977-.072l.084.072a.75.75 0 0 1 .072.977l-.072.084L8.53 11.78a.75.75 0 0 1-.976.073l-.084-.073l-3.536-3.535a.75.75 0 0 1 .977-1.133l.084.072L7.25 9.44V1.75a.75.75 0 0 1 .648-.743L8 1l-.102.007z",fill:"currentColor"}],upload:[{d:"M3.75 2a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5zm4.78 2.72a.75.75 0 0 0-1.06 0L4.22 7.97a.75.75 0 0 0 1.06 1.06l1.97-1.97v6.19a.75.75 0 0 0 1.5 0V7.06l1.97 1.97a.75.75 0 1 0 1.06-1.06L8.53 4.72z",fill:"currentColor"}],edit:[{d:"M13.416 2.584c.778.778.778 2.039 0 2.817L6.058 12.76c-.319.32-.719.546-1.156.655l-2.283.57a.498.498 0 0 1-.604-.603l.57-2.283a2.49 2.49 0 0 1 .656-1.156l7.358-7.358a1.992 1.992 0 0 1 2.817 0zM9.894 4.697l-5.949 5.949a1.495 1.495 0 0 0-.393.694l-.369 1.477l1.477-.37c.263-.065.503-.2.694-.392l5.949-5.95l-1.409-1.408zm1.41-1.41l-.705.705l1.408 1.409l.705-.704a.996.996 0 0 0-1.409-1.41z",fill:"currentColor"}]};var x={props:{size:{type:[Number,String],default:20},color:{type:String,default:"currentColor"},viewBox:{type:String,default:"0 0 16 16"},paths:{type:Array,required:!0}},setup(e){return()=>(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:e.viewBox,fill:e.color,width:e.size,height:e.size,"aria-hidden":"true",focusable:"false"},e.paths.map(e=>(0,n.h)("path",e)))}};const C=x;var E=C;const j={class:"tool-panel"};var O=(0,n.pM)({__name:"ToolPanel",props:{elements:{type:Array,default:()=>[]},isRunning:Boolean,isStopped:Boolean,selectedNode:Object,selectedEdge:Object},emits:["add-node","start-flow","stop-flow","continue-flow","reset-flow","update-node-label","delete-selected-edge","import-json"],setup(e,{emit:l}){const{getEdges:a}=(0,u.Id)(),t=(0,s.J)(),r=(0,o.KR)(null),i=e=>{const l=F?.[e];return l?(0,n.h)(E,{paths:l}):null},w=i("question"),x=i("plus"),C=i("play"),O=i("pause"),U=i("delete"),$=i("refresh"),z=i("code"),W=i("download"),X=i("upload"),L=i("edit"),K=e,N=l,M=(0,o.KR)("my_flow"),S=(0,o.KR)("My flow's description"),I=(0,o.KR)(""),P=(0,o.KR)(""),B=(0,o.KR)(!1),T=(0,o.KR)(!1),J=(0,o.KR)(!1),V=(0,n.EW)(()=>{const e=new Set;let l="start";while(l&&"end"!==l){if(e.has(l))return!1;e.add(l);const t=a.value.filter(e=>e.source===l);if(1!==t.length)return!1;l=t[0].target}return"end"===l}),q=e=>{const l=K.elements.filter(l=>l.source===e&&l.target);return l.length>0?l[0].target:null},D=()=>{const e=[];let l="start";while("end"!==l){const a=q(l);if(!a||"end"===a)break;const t=K.elements.find(e=>e.id===a);if(t&&!ne(t.id)){const l={name:t.data.label};if("proc_get_request"===t.data.label)l.executor={type:"http",config:{silent:!0,headers:t.data.headers}},l.command=`GET ${t.data.url}`,l.output=t.data.label.toUpperCase()+"_DATA",t.data.headers&&t.data.headers.length>0&&(l.executor.config.headers=t.data.headers.reduce((e,l)=>{const[a,t]=l.split(":").map(e=>e.trim());return a&&t&&(e[a]=t),e},{}));else if("proc_json_filter"===t.data.label){l.executor="command";let e=`\nconst input = JSON.parse(process.env.${Q(t.id)});\nconst result = ${t.data.list||"input"}.filter(item => {\n  return ${H(t.data.conditions||[])};\n});\n${t.data.output_fields?.length>0?`console.log(JSON.stringify(result.map(item => (${Y(t.data.output_fields)}))));`:"console.log(JSON.stringify(result));"}\n`;l.command=`node -e "${e.replace(/"/g,'\\"').replace(/\n/g,"")}"`,l.output="FILTERED_DATA"}else l.command=t.data.command||"";e.push(l)}l=a}const a={name:M.value,description:S.value,steps:e};I.value=A().stringify(a)},Q=e=>{const l=a.value,t=l.find(l=>l.target===e);if(!t)return"";const n=K.elements.find(e=>e.id===t.source);return n?`${n.data.label.toUpperCase()}_DATA`:""},H=e=>e.filter(e=>e.field&&e.operator&&void 0!==e.value).map(e=>{const l=e.field.includes(".")?e.field.split(".").join("?."):`item?.${e.field}`;let a=e.value;switch("string"===typeof a&&!["true","false"].includes(a)&&isNaN(Number(a))&&(a=`'${a.replace(/'/g,"\\'")}'`),e.operator){case"==":return`${l} == ${a}`;case"!=":return`${l} != ${a}`;case"contains":return`${l}?.includes(${a})`;default:return`${l} ${e.operator} ${a}`}}).join(" && ")||"true",Y=e=>`{\n    ${e.map(e=>`'${e}': item?.${e}`).join(",\n    ")}\n  }`,G=()=>{const e=[];let l="start";while("end"!==l){const a=q(l);if(!a||"end"===a)break;const t=K.elements.find(e=>e.id===a);if(t&&!ne(t.id)){const l={name:t.data.label,command:t.data.command||""},a=Object.keys(t.data).filter(e=>!["label","command","processFunction"].includes(e)).reduce((e,l)=>(e[l]=t.data[l],e),{});Object.keys(a).length>0&&(l.params=a),e.push(l)}l=a}const a={name:M.value,description:S.value,steps:e};P.value=JSON.stringify(a,null,2)},Z=()=>{if(!I.value)return;const e=new Blob([I.value],{type:"application/yaml"}),l=URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=`${M.value}.yaml`.replace(/\s+/g,"_"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l)},ee=()=>{if(!P.value)return;const e=new Blob([P.value],{type:"application/json"}),l=URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=`${M.value}.json`.replace(/\s+/g,"_"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l)},le=()=>{r.value?.click()},ae=async e=>{const l=e.target;if(!l.files||0===l.files.length)return;const a=l.files[0];if(a)try{const e=await te(a),l=JSON.parse(e);if(!l||"object"!==typeof l)throw new Error("Invalid JSON format");M.value=l.name||"imported_flow",S.value=l.description||"",N("import-json",l),t.success("Flow импортирован успешно")}catch(n){t.error(`Import failed: ${n instanceof Error?n.message:"Unknown error"}`),console.error("Import error:",n)}finally{l&&(l.value="")}},te=e=>new Promise((l,a)=>{const t=new FileReader;t.onload=()=>l(t.result),t.onerror=()=>a(new Error("File reading failed")),t.readAsText(e)}),ne=e=>"start"===e||"end"===e;return(e,l)=>((0,n.uX)(),(0,n.CE)("div",j,[(0,n.bF)((0,o.R1)(c.A),{justify:"space-between",align:"center",style:{padding:"7px 17px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(c.A),{style:{padding:"0 17px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),{style:{color:"#f2f2f2","font-size":"20px"},strong:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,d.v_)(M.value),1)]),_:1}),(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click"},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{text:"",style:{"font-size":"18px"},color:"#c7c7c7"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(L))]),_:1})]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(y.Ay),{title:"Настройки пайплайна",size:"small",style:{width:"300px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(g.Ay),{label:"Название",path:"flowName"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:M.value,"onUpdate:value":l[0]||(l[0]=e=>M.value=e),placeholder:"Введите название"},null,8,["value"])]),_:1}),(0,n.bF)((0,o.R1)(g.Ay),{label:"Описание",path:"flowDescription"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:S.value,"onUpdate:value":l[1]||(l[1]=e=>S.value=e),placeholder:"Введите описание",type:"textarea"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),(0,n.bF)((0,o.R1)(c.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[2]||(l[2]=l=>e.$emit("add-node")),type:"primary",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(x))]),_:1})]),_:1}),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[3]||(l[3]=l=>e.$emit("start-flow")),disabled:!V.value||K.isRunning,type:"success",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(C))]),_:1})]),_:1},8,["disabled"]),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[4]||(l[4]=l=>e.$emit("stop-flow")),disabled:!K.isRunning||K.isStopped,type:"warning",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(O))]),_:1})]),_:1},8,["disabled"]),K.isStopped?((0,n.uX)(),(0,n.Wv)((0,o.R1)(f.Ay),{key:0,onClick:l[5]||(l[5]=l=>e.$emit("reset-flow")),type:"error",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)($))]),_:1})]),_:1})):(0,n.Q3)("",!0)]),_:1}),K.selectedEdge?((0,n.uX)(),(0,n.Wv)((0,o.R1)(c.A),{key:0},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[6]||(l[6]=l=>e.$emit("delete-selected-edge")),type:"error",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(U))]),_:1})]),_:1})]),_:1})):(0,n.Q3)("",!0),(0,n.bF)((0,o.R1)(c.A),null,{default:(0,n.k6)(()=>[V.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click",show:T.value},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[7]||(l[7]=e=>{D(),T.value=!T.value}),ghost:"",color:"#c7c7c7",size:"small"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(z))]),_:1})]),default:(0,n.k6)(()=>[l[13]||(l[13]=(0,n.eW)(" YAML "))]),_:1,__:[13]})]),default:(0,n.k6)(()=>[I.value?((0,n.uX)(),(0,n.Wv)((0,o.R1)(y.Ay),{key:0,title:"DAGU Config",size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(_.A),{language:"yaml",code:I.value,"word-wrap":""},null,8,["code"])]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["show"]),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[8]||(l[8]=e=>Z()),size:"small",ghost:"",color:"#c7c7c7"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(W))]),_:1})]),default:(0,n.k6)(()=>[l[14]||(l[14]=(0,n.eW)(" Export YAML "))]),_:1,__:[14]}),(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click",show:B.value},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[9]||(l[9]=e=>{G(),B.value=!B.value}),ghost:"",color:"#c7c7c7",size:"small"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(z))]),_:1})]),default:(0,n.k6)(()=>[l[15]||(l[15]=(0,n.eW)(" JSON "))]),_:1,__:[15]})]),default:(0,n.k6)(()=>[P.value?((0,n.uX)(),(0,n.Wv)((0,o.R1)(y.Ay),{key:0,title:"Конфигурация JSON",size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(_.A),{language:"json",code:P.value,"word-wrap":""},null,8,["code"])]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["show"]),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[10]||(l[10]=e=>ee()),size:"small",ghost:"",color:"#c7c7c7"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(W))]),_:1})]),default:(0,n.k6)(()=>[l[16]||(l[16]=(0,n.eW)(" Export JSON "))]),_:1,__:[16]})],64)):(0,n.Q3)("",!0),(0,n.Lk)("input",{type:"file",ref_key:"fileInput",ref:r,accept:".json",style:{display:"none"},onChange:ae},null,544),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[11]||(l[11]=e=>le()),ghost:"",color:"#c7c7c7",size:"small"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(X))]),_:1})]),default:(0,n.k6)(()=>[l[17]||(l[17]=(0,n.eW)(" Import JSON "))]),_:1,__:[17]})]),_:1}),(0,n.bF)((0,o.R1)(c.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click",show:J.value},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[12]||(l[12]=e=>J.value=!J.value),ghost:"",color:"#c7c7c7",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(w))]),_:1})]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(k.Ay),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[18]||(l[18]=[(0,n.Lk)("strong",null,"ЛКМ",-1),(0,n.eW)(" - Выбрать шаг")])),_:1,__:[18]})]),_:1}),(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[19]||(l[19]=[(0,n.Lk)("strong",null,"ПКМ",-1),(0,n.eW)(" - Редактировать параметры шага")])),_:1,__:[19]})]),_:1}),(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[20]||(l[20]=[(0,n.Lk)("strong",null,"Ctrl+A",-1),(0,n.eW)(" - Добавить новый шаг")])),_:1,__:[20]})]),_:1}),(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[21]||(l[21]=[(0,n.Lk)("strong",null,"Ctrl+X",-1),(0,n.eW)(" - Удалить выбранный шаг или связь")])),_:1,__:[21]})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1})]))}}),U=a(1241);const $=(0,U.A)(O,[["__scopeId","data-v-22c38c89"]]);var z=$,W=a(9387),X=a(9542),L=a(7453),K=a(9190),N=a(8898),M=JSON.parse('{"proc":[{"name":"get_request","params":[{"name":"url","type":"string","required":true},{"name":"headers","type":"array","item":{"type":"string"},"default":[]}]},{"name":"comparison","params":[{"name":"propertyName","type":"string","required":true},{"name":"order","type":"string","enum":["<",">"],"required":true,"default":"<"}]},{"name":"iterate","params":[{"name":"print","type":"boolean","default":true}]},{"name":"json_filter","params":[{"name":"list","type":"string","required":true,"description":"Путь к массиву в JSON (например, \'.users\')"},{"name":"conditions","type":"array","item":{"type":"object","properties":{"field":{"type":"string","description":"Поле для фильтрации"},"operator":{"type":"string","enum":["==","!=",">","<",">=","<=","contains"],"description":"Оператор сравнения"},"value":{"type":["string","number","boolean"],"description":"Значение для сравнения"}},"required":["field","operator","value"]},"description":"Условия фильтрации"},{"name":"output_fields","type":"array","item":{"type":"string"},"description":"Поля для вывода (если не указаны - выводятся все)"}]}],"bx24":[{"name":"get_deals","params":[]},{"name":"get_deal_by_id","params":[{"name":"id","type":"string"}]}]}');const S=e=>e,I=S(M);var P=I;const B={style:{display:"flex","justify-content":"flex-end","margin-top":"20px"}};var T=(0,n.pM)({__name:"NodeContextMenu",props:{node:{type:Object,required:!0},visible:Boolean,x:Number,y:Number},emits:["update:visible","update-label","update-command","update-params"],setup(e,{emit:l}){const a=(0,s.J)(),t=e,u=l,r=(0,o.KR)(""),i=(0,o.KR)({conditions:[],output_fields:[]}),p=(0,o.KR)({field:"",operator:"==",value:""}),v=[{label:"=",value:"=="},{label:"≠",value:"!="},{label:">",value:">"},{label:"<",value:"<"},{label:"≥",value:">="},{label:"≤",value:"<="},{label:"содержит",value:"contains"}],b=(0,n.EW)(()=>{if(!t.node?.data?.label)return[];for(const e of Object.values(P)){const l=e.find(e=>t.node.data.label.includes(e.name));if(l)return l.params||[]}return[]});(0,n.wB)(()=>t.node,e=>{e?.data&&(r.value=e.data.label,i.value={conditions:[],output_fields:[]},b.value.forEach(l=>{"conditions"===l.name?i.value.conditions=Array.isArray(e.data[l.name])?[...e.data[l.name]]:[]:"output_fields"===l.name?i.value.output_fields=Array.isArray(e.data[l.name])?[...e.data[l.name]]:[]:i.value[l.name]=void 0!==e.data[l.name]?e.data[l.name]:l.default}))},{immediate:!0,deep:!0});const _=()=>{p.value.field?(i.value.conditions.push({...p.value}),p.value={field:"",operator:"==",value:""}):a.error("Поле не может быть пустым")},k=e=>{i.value.conditions.splice(e,1)},R=()=>{u("update-label",r.value),u("update-params",{...i.value,conditions:i.value.conditions.filter(e=>e.field&&void 0!==e.value)}),u("update:visible",!1)},w=(0,n.EW)(()=>({left:`${t.x}px`,top:`${t.y}px`,position:"absolute",zIndex:1e3})),A=()=>{u("update-label",r.value)};return(l,a)=>e.visible?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"node-context-menu",style:(0,d.Tr)(w.value)},[(0,n.bF)((0,o.R1)(y.Ay),{title:"Редактирование шага",size:"small",style:{width:"350px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(g.Ay),{label:"Название шага"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:r.value,"onUpdate:value":a[0]||(a[0]=e=>r.value=e),onBlur:A},null,8,["value"])]),_:1}),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(b.value,l=>((0,n.uX)(),(0,n.CE)(n.FK,{key:l.name},["list"===l.name&&"proc_json_filter"===e.node.data.label?((0,n.uX)(),(0,n.Wv)((0,o.R1)(g.Ay),{key:0,label:"Путь к массиву"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:i.value[l.name],"onUpdate:value":e=>i.value[l.name]=e,placeholder:"Например: .users"},null,8,["value","onUpdate:value"])]),_:2},1024)):"conditions"===l.name&&"proc_json_filter"===e.node.data.label?((0,n.uX)(),(0,n.Wv)((0,o.R1)(g.Ay),{key:1,label:"Условия фильтрации"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(c.A),{vertical:""},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(c.A),{wrap:""},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.value.conditions,(e,l)=>((0,n.uX)(),(0,n.Wv)((0,o.R1)(W.Ay),{key:l,closable:"",onClose:e=>k(l),type:"info"},{default:(0,n.k6)(()=>[(0,n.eW)((0,d.v_)(e.field)+" "+(0,d.v_)(e.operator)+" "+(0,d.v_)(e.value),1)]),_:2},1032,["onClose"]))),128))]),_:1}),(0,n.bF)((0,o.R1)(c.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:p.value.field,"onUpdate:value":a[1]||(a[1]=e=>p.value.field=e),placeholder:"Поле",style:{width:"100px"}},null,8,["value"]),(0,n.bF)((0,o.R1)(X.A),{value:p.value.operator,"onUpdate:value":a[2]||(a[2]=e=>p.value.operator=e),options:v,style:{width:"100px"}},null,8,["value"]),(0,n.bF)((0,o.R1)(h.A),{value:p.value.value,"onUpdate:value":a[3]||(a[3]=e=>p.value.value=e),placeholder:"Значение",style:{width:"100px"}},null,8,["value"]),(0,n.bF)((0,o.R1)(f.Ay),{onClick:_,type:"primary",size:"small"},{default:(0,n.k6)(()=>a[5]||(a[5]=[(0,n.eW)(" Добавить ")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})):"output_fields"===l.name&&"proc_json_filter"===e.node.data.label?((0,n.uX)(),(0,n.Wv)((0,o.R1)(g.Ay),{key:2,label:"Выводимые поля"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(L.A),{value:i.value.output_fields,"onUpdate:value":a[4]||(a[4]=e=>i.value.output_fields=e)},null,8,["value"])]),_:1})):((0,n.uX)(),(0,n.Wv)((0,o.R1)(g.Ay),{key:3,label:l.name},{default:(0,n.k6)(()=>["string"!==l.type||l.enum?"string"===l.type&&l.enum?((0,n.uX)(),(0,n.Wv)((0,o.R1)(X.A),{key:1,value:i.value[l.name],"onUpdate:value":e=>i.value[l.name]=e,options:l.enum.map(e=>({label:e,value:e}))},null,8,["value","onUpdate:value","options"])):"number"===l.type?((0,n.uX)(),(0,n.Wv)((0,o.R1)(K.A),{key:2,value:i.value[l.name],"onUpdate:value":e=>i.value[l.name]=e},null,8,["value","onUpdate:value"])):"boolean"===l.type?((0,n.uX)(),(0,n.Wv)((0,o.R1)(N.A),{key:3,value:i.value[l.name],"onUpdate:value":e=>i.value[l.name]=e},null,8,["value","onUpdate:value"])):"array"===l.type&&"string"===l.item?.type?((0,n.uX)(),(0,n.Wv)((0,o.R1)(L.A),{key:4,value:i.value[l.name],"onUpdate:value":e=>i.value[l.name]=e},null,8,["value","onUpdate:value"])):(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)((0,o.R1)(h.A),{key:0,value:i.value[l.name],"onUpdate:value":e=>i.value[l.name]=e,placeholder:l.required?"Обязательное поле":""},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label"]))],64))),128)),(0,n.Lk)("div",B,[(0,n.bF)((0,o.R1)(f.Ay),{onClick:R,type:"primary"},{default:(0,n.k6)(()=>a[6]||(a[6]=[(0,n.eW)("Сохранить")])),_:1,__:[6]})])]),_:1})]),_:1})],4)):(0,n.Q3)("",!0)}});const J=(0,U.A)(T,[["__scopeId","data-v-42c00bc0"]]);var V=J,q=a(9200),D=(0,n.pM)({__name:"NodeSelectionMenu",props:{show:Boolean,position:{type:Object,default:()=>({x:0,y:0})}},emits:["select","update:show"],setup(e,{emit:l}){const a=e,t=l,u=(0,n.EW)({get:()=>a.show,set:e=>t("update:show",e)}),r=(0,n.EW)(()=>{const e=[];for(const[l,a]of Object.entries(P))e.push({type:"group",label:l.toUpperCase(),key:l,children:a.map(e=>({label:`${l}_${e.name}`,key:`${l}_${e.name}`,nodeData:e}))});return e}),i=(e,l)=>{t("select",{label:e,params:l.nodeData.params}),u.value=!1};return(l,a)=>((0,n.uX)(),(0,n.Wv)((0,o.R1)(q.A),{show:u.value,"onUpdate:show":a[0]||(a[0]=e=>u.value=e),options:r.value,x:e.position.x,y:e.position.y,placement:"bottom-start",trigger:"manual",onSelect:i},{default:(0,n.k6)(()=>a[1]||(a[1]=[(0,n.Lk)("div",{style:{position:"absolute",left:"-9999px"}},null,-1)])),_:1,__:[1]},8,["show","options","x","y"]))}});const Q=D;var H=Q,Y=(0,n.pM)({__name:"FlowBuilder",setup(e){const l=(0,o.KR)([{id:"start",type:"input",data:{label:"start",processFunction:async()=>{console.log("start"),await E(1e3)}},position:{x:50,y:50},sourcePosition:u.yX.Bottom,style:{backgroundColor:"#d0d0d0",color:"black",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1},{id:"end",type:"output",data:{label:"end",processFunction:async()=>{console.log("end"),await E(1e3)}},position:{x:500,y:400},sourcePosition:u.yX.Top,style:{backgroundColor:"#454545",color:"white",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1}]),{removeEdges:a,addNodes:t,updateNode:d,removeNodes:s,getEdges:c,setNodes:p,setEdges:v,fitView:f}=(0,u.Id)(),b=(0,o.KR)(!1),y=(0,o.KR)(!1),m=(0,o.KR)(null),g=(0,o.KR)(null),h=(0,o.KR)(null),_=(0,o.KR)(!1),k=(0,o.KR)(null),R=(0,o.KR)(null),w=(0,o.KR)(!1),A=(0,o.KR)({x:0,y:0}),F=(0,o.KR)(!1),x=(0,o.KR)({x:0,y:0}),C=(0,n.EW)(()=>{let e=0,l="start";while("end"!==l){const a=ae(l);if(!a||"end"===a)break;e++,l=a}return e}),E=e=>new Promise(l=>setTimeout(l,e)),j=e=>"start"===e||"end"===e,O=e=>"input"===e.type?"input-node":"output"===e.type?"output-node":"default-node",U=({pane:e})=>{e&&(e.tabIndex=0,e.focus())},$=e=>{!e.ctrlKey&&!e.metaKey||"x"!==e.key&&"ч"!==e.key||(e.preventDefault(),W(),q()),!e.ctrlKey&&!e.metaKey||"a"!==e.key&&"ф"!==e.key||(e.preventDefault(),X())},W=()=>{if(!g.value||j(g.value.id))return void console.warn("Нет выбранной ноды для удаления или нода защищена");const e=g.value.id,t=c.value.filter(l=>l.source===e||l.target===e);t.length>0&&a(t),s([e]),l.value=l.value.filter(l=>l.id!==e&&!t.some(e=>e.id===l.id)),g.value=null,B(),D()},X=e=>{if(e)x.value={x:e.clientX,y:e.clientY};else{const e=window.innerWidth/2,l=window.innerHeight/2;x.value={x:e,y:l}}F.value=!0},L=e=>{const a=(0,r.A)(),n=e.params.reduce((e,l)=>(e[l.name]=void 0!==l.default?l.default:"",e),{}),o={id:a,data:{label:e.label,...n,processFunction:async()=>{console.log(`Выполняется шаг ${a}`),await E(1e3)}},position:{x:100+100*C.value,y:150},targetPosition:u.yX.Top,sourcePosition:u.yX.Bottom,style:{backgroundColor:"#2196F3",color:"white",borderRadius:"50%",width:"80px",height:"80px"}};l.value.push(o),t([o]),F.value=!1},K=e=>{const a={id:`edge-${e.source}-${e.target}`,source:e.source,target:e.target};l.value=(0,u.rN)(a,l.value),_.value=!1,D()},N=e=>{if(!_.value){if(j(e.node.id))return g.value=null,h.value=null,void B();g.value=e.node,h.value=null,B()}},M=e=>{g.value=null,h.value=e.edge,B()},S=(e,l)=>{console.log("onUpdateEdge",l)},I=e=>{if(!e?.node||j(e.node.id))return;e.event.preventDefault(),g.value=e.node,R.value=e.node;const l=k.value?.getBoundingClientRect();l&&(A.value={x:e.event.clientX-l.left,y:e.event.clientY-l.top},w.value=!0)},P=()=>{B()},B=()=>{R.value=null},T=e=>{if(g.value&&!j(g.value.id)){const a=l.value.findIndex(e=>e.id===g.value?.id);-1!==a&&(l.value[a].data.label=e,d(g.value.id,l.value[a]))}},J=e=>{if(g.value){const a=l.value.findIndex(e=>e.id===g.value?.id);if(-1!==a){const t={...l.value[a]};Object.keys(e).forEach(l=>{t.data[l]=e[l]}),l.value[a]=t,d(t.id,t)}}},q=()=>{h.value&&(a([h.value]),l.value=l.value.filter(e=>e.id!==h.value?.id),h.value=null,D())},D=()=>{let e="start";while("end"!==e){const a=ae(e);if(!a||"end"===a)break;const t=l.value.find(e=>e.id===a);t&&!j(t.id)&&d(t.id,t),e=a}},Q=e=>{try{if(!e?.steps||!Array.isArray(e.steps))throw new Error("Invalid configuration: missing steps array");const a=[],t=[];let o=50;const i=150;if(a.push({id:"start",type:"input",data:{label:"start",processFunction:async()=>await E(1e3)},position:{x:o,y:50},sourcePosition:u.yX.Bottom,style:{backgroundColor:"#d0d0d0",color:"black",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1}),o+=200,e.steps.forEach(e=>{const l=(0,r.A)(),n={label:e.name,command:e.command||"",processFunction:async()=>await E(1e3)};if(e.params&&Object.keys(e.params).forEach(l=>{n[l]=e.params[l]}),a.push({id:l,data:n,position:{x:o,y:i},targetPosition:u.yX.Top,sourcePosition:u.yX.Bottom,style:{backgroundColor:"#2196F3",color:"white",borderRadius:"50%",width:"80px",height:"80px"},draggable:!0,selectable:!0,deletable:!0}),a.length>1){const e=a[a.length-2];t.push({id:`edge-${e.id}-${l}`,source:e.id,target:l})}o+=200}),a.push({id:"end",type:"output",data:{label:"end",command:"",processFunction:async()=>await E(1e3)},position:{x:o,y:50},sourcePosition:u.yX.Top,style:{backgroundColor:"#454545",color:"white",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1}),a.length>2){const e=a[a.length-2];t.push({id:`edge-${e.id}-end`,source:e.id,target:"end"})}l.value=[...a,...t],p(a),v(t),(0,n.dY)(()=>f({padding:.5}))}catch(a){console.error("Graph import error:",a)}},Y=async()=>{b.value=!0,y.value=!1,m.value="start";try{await le("start");let e=ae("start");while(e&&b.value)m.value=e,await le(e),e=ae(e);b.value&&(m.value="end",await le("end"))}catch(e){console.error("Ошибка выполнения графа:",e)}finally{b.value=!1,m.value=null}},G=()=>{b.value=!1,y.value=!0},Z=async()=>{if(m.value){y.value=!1,b.value=!0;try{let e=ae(m.value);while(e&&b.value)m.value=e,await le(e),e=ae(e);b.value&&(m.value="end",await le("end"))}catch(e){console.error("Ошибка выполнения графа:",e)}finally{b.value=!1,y.value=!1,m.value=null}}},ee=()=>{b.value=!1,y.value=!1,m.value=null},le=async e=>{const a=l.value.find(l=>l.id===e);a?.data?.processFunction&&await a.data.processFunction()},ae=e=>{const a=l.value.filter(l=>l.source===e&&l.target);return a.length>0?a[0].target:null};return(0,n.sV)(()=>{k.value&&k.value.focus()}),(e,a)=>((0,n.uX)(),(0,n.CE)("div",{class:"flow-container",tabindex:"0",onKeydown:$},[(0,n.bF)((0,o.R1)(i.A),null,{default:(0,n.k6)(()=>[(0,n.bF)(z,{elements:l.value,"is-running":b.value,"is-stopped":y.value,"selected-node":g.value,"selected-edge":h.value,onAddNode:X,onStartFlow:Y,onStopFlow:G,onContinueFlow:Z,onResetFlow:ee,onUpdateNodeLabel:T,onDeleteSelectedEdge:q,onImportJson:Q},null,8,["elements","is-running","is-stopped","selected-node","selected-edge"]),(0,n.Lk)("div",{class:"flow-wrapper",ref_key:"flowWrapper",ref:k},[(0,n.bF)((0,o.R1)(u.nO),{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),style:{width:"100%",height:"88vh",background:"#fcfcfc"},onNodeClick:N,onEdgeClick:M,onUpdateEdge:S,onNodeContextMenu:I,onPaneClick:P,"connection-mode":_.value,onConnect:K,onPaneReady:U,"node-class":O},null,8,["modelValue","connection-mode"]),w.value&&R.value?((0,n.uX)(),(0,n.Wv)(V,{key:0,node:R.value,visible:w.value,x:A.value.x,y:A.value.y,"onUpdate:visible":a[1]||(a[1]=e=>w.value=e),onUpdateLabel:T,onUpdateCommand:e.updateNodeCommand,onUpdateParams:J},null,8,["node","visible","x","y","onUpdateCommand"])):(0,n.Q3)("",!0),F.value?((0,n.uX)(),(0,n.Wv)(H,{key:1,show:F.value,position:x.value,"onUpdate:show":a[2]||(a[2]=e=>F.value=e),onSelect:L},null,8,["show","position"])):(0,n.Q3)("",!0)],512)]),_:1})],32))}});const G=(0,U.A)(Y,[["__scopeId","data-v-0b77397a"]]);var Z=G,ee=a(1418),le=a(7494),ae=(0,n.pM)({__name:"App",setup(e){return ee.A.registerLanguage("javascript",le.A),(e,l)=>{const a=(0,n.g2)("n-message-provider"),t=(0,n.g2)("n-config-provider");return(0,n.uX)(),(0,n.Wv)(t,{hljs:(0,o.R1)(ee.A)},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)(Z)]),_:1})]),_:1},8,["hljs"])}}});const te=ae;var ne=te,oe={beforeMount(e,l){e.clickOutsideEvent=function(a){e===a.target||e.contains(a.target)||l.value(a)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.body.removeEventListener("click",e.clickOutsideEvent)}},ue=a(8158);const re=(0,t.Ef)(ne);re.directive("click-outside",oe),re.use(ue.A),re.mount("#app")}},l={};function a(t){var n=l[t];if(void 0!==n)return n.exports;var o=l[t]={exports:{}};return e[t].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(l,t,n,o){if(!t){var u=1/0;for(s=0;s<e.length;s++){t=e[s][0],n=e[s][1],o=e[s][2];for(var r=!0,i=0;i<t.length;i++)(!1&o||u>=o)&&Object.keys(a.O).every(function(e){return a.O[e](t[i])})?t.splice(i--,1):(r=!1,o<u&&(u=o));if(r){e.splice(s--,1);var d=n();void 0!==d&&(l=d)}}return l}o=o||0;for(var s=e.length;s>0&&e[s-1][2]>o;s--)e[s]=e[s-1];e[s]=[t,n,o]}}(),function(){a.n=function(e){var l=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(l,{a:l}),l}}(),function(){a.d=function(e,l){for(var t in l)a.o(l,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:l[t]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(l){return 0===e[l]};var l=function(l,t){var n,o,u=t[0],r=t[1],i=t[2],d=0;if(u.some(function(l){return 0!==e[l]})){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(i)var s=i(a)}for(l&&l(t);d<u.length;d++)o=u[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(s)},t=self["webpackChunkflow_builder"]=self["webpackChunkflow_builder"]||[];t.forEach(l.bind(null,0)),t.push=l.bind(null,t.push.bind(t))}();var t=a.O(void 0,[504],function(){return a(2607)});t=a.O(t)})();
//# sourceMappingURL=app.8209c9d4.js.map