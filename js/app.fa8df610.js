(function(){"use strict";var e={8051:function(e,l,a){var t=a(5130),n=a(6768),o=a(144),u=(a(4114),a(8111),a(2489),a(116),a(7588),a(8237),a(3579),a(6805)),r=(a(99),a(4963)),i=a(8096),d=(a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4232)),s=a(7387),c=a(7671),p=a(3109),v=a(6921),f=a(1389),m=a(7966),b=a(2517),y=a(8911),g=a(5045),h=a(4390),k=a(605),_=a(7430),R=a(4428),w=a(1307),F=a.n(w);const A={proc:[{name:"comparison",params:[{name:"propertyName",type:"string",required:!0},{name:"order",type:"string",enum:["<",">"],required:!0,default:"<"}]},{name:"iterate",params:[{name:"print",type:"boolean",default:!0}]}],bx24:[{name:"get_deals",params:[]},{name:"get_deal_by_id",params:[{name:"id",type:"string"}]}]};var x=A;const C={question:[{d:"M8 2C6.346 2 5 3.346 5 5a.75.75 0 0 0 1.5 0c0-.826.674-1.5 1.5-1.5s1.5.674 1.5 1.5c0 .653-.122 1.018-.254 1.25c-.137.242-.321.41-.601.643l-.051.042c-.26.215-.612.507-.88.939c-.3.483-.464 1.08-.464 1.876v.5a.75.75 0 0 0 1.5 0v-.5c0-.579.116-.888.239-1.085c.136-.219.316-.37.616-.62c.283-.236.66-.553.945-1.053c.29-.51.45-1.145.45-1.992c0-1.654-1.346-3-3-3zm0 12.25a1 1 0 1 0 0-2a1 1 0 0 0 0 2z",fill:"currentColor"}],settings:[{d:"M2.267 6.153A5.986 5.986 0 0 1 3.53 3.98a.355.355 0 0 1 .382-.095l1.36.484a.71.71 0 0 0 .935-.538l.26-1.416a.354.354 0 0 1 .274-.282a6.072 6.072 0 0 1 2.52 0c.14.03.248.141.274.282l.26 1.416a.708.708 0 0 0 .935.538l1.36-.484a.355.355 0 0 1 .382.095c.569.627 1 1.367 1.262 2.173a.352.352 0 0 1-.108.378l-1.102.931a.703.703 0 0 0 0 1.076l1.102.931c.11.093.152.242.108.378a5.985 5.985 0 0 1-1.262 2.173a.355.355 0 0 1-.382.095l-1.36-.484a.71.71 0 0 0-.935.538l-.26 1.416a.353.353 0 0 1-.275.282a6.068 6.068 0 0 1-2.519 0a.354.354 0 0 1-.275-.282l-.259-1.416a.708.708 0 0 0-.935-.538l-1.36.484a.355.355 0 0 1-.382-.095a5.986 5.986 0 0 1-1.262-2.173a.352.352 0 0 1 .108-.378l1.102-.931a.704.704 0 0 0 0-1.076l-1.102-.931a.352.352 0 0 1-.108-.378zM6.25 8a1.75 1.75 0 1 0 3.5 0a1.75 1.75 0 0 0-3.5 0z",fill:"currentColor"}],plus:[{d:"M8.5 2.75a.75.75 0 0 0-1.5 0V7H2.75a.75.75 0 0 0 0 1.5H7v4.25a.75.75 0 0 0 1.5 0V8.5h4.25a.75.75 0 0 0 0-1.5H8.5V2.75z",fill:"currentColor"}],play:[{d:"M6.235 2.192A1.5 1.5 0 0 0 4 3.499v9a1.5 1.5 0 0 0 2.235 1.308l8-4.5a1.5 1.5 0 0 0 0-2.615l-8-4.5z",fill:"currentColor"}],pause:[{d:"M3.5 2A1.5 1.5 0 0 0 2 3.5v9A1.5 1.5 0 0 0 3.5 14h2A1.5 1.5 0 0 0 7 12.5v-9A1.5 1.5 0 0 0 5.5 2h-2zm7 0A1.5 1.5 0 0 0 9 3.5v9a1.5 1.5 0 0 0 1.5 1.5h2a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 12.5 2h-2z",fill:"currentColor"}],delete:[{d:"M10 4h3a.5.5 0 0 1 0 1h-.553l-.752 6.776A2.5 2.5 0 0 1 9.21 14H6.79a2.5 2.5 0 0 1-2.485-2.224L3.552 5H3a.5.5 0 0 1 0-1h3a2 2 0 1 1 4 0zM8 3a1 1 0 0 0-1 1h2a1 1 0 0 0-1-1zM6.5 7v4a.5.5 0 0 0 1 0V7a.5.5 0 0 0-1 0zM9 6.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 1 0V7a.5.5 0 0 0-.5-.5z",fill:"currentColor"}],refresh:[{d:"M3 8a5 5 0 0 1 9-3H9.5a.5.5 0 0 0 0 1h3a.5.5 0 0 0 .5-.5v-.657V2.5a.5.5 0 0 0-1 0v1.028A6 6 0 1 0 14 8a.5.5 0 0 0-1 0A5 5 0 0 1 3 8z",fill:"currentColor"}],code:[{d:"M9.803 3.043a.5.5 0 0 1 .254.66l-4 9a.5.5 0 0 1-.914-.406l4-9a.5.5 0 0 1 .66-.254zm-5.47 2.333a.5.5 0 0 1 .04.706L2.67 8l1.705 1.918a.5.5 0 1 1-.748.664l-2-2.25a.5.5 0 0 1 0-.664l2-2.25a.5.5 0 0 1 .706-.042zm7.335 0a.5.5 0 0 1 .706.042l2 2.25a.5.5 0 0 1 0 .664l-2 2.25a.5.5 0 1 1-.748-.664L13.331 8l-1.705-1.918a.5.5 0 0 1 .042-.706z",fill:"currentColor"}],download:[{d:"M3.5 13h9a.75.75 0 0 1 .102 1.493l-.102.007h-9a.75.75 0 0 1-.102-1.493L3.5 13h9h-9zM7.898 1.007L8 1a.75.75 0 0 1 .743.648l.007.102v7.688l2.255-2.254a.75.75 0 0 1 .977-.072l.084.072a.75.75 0 0 1 .072.977l-.072.084L8.53 11.78a.75.75 0 0 1-.976.073l-.084-.073l-3.536-3.535a.75.75 0 0 1 .977-1.133l.084.072L7.25 9.44V1.75a.75.75 0 0 1 .648-.743L8 1l-.102.007z",fill:"currentColor"}],upload:[{d:"M3.75 2a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5zm4.78 2.72a.75.75 0 0 0-1.06 0L4.22 7.97a.75.75 0 0 0 1.06 1.06l1.97-1.97v6.19a.75.75 0 0 0 1.5 0V7.06l1.97 1.97a.75.75 0 1 0 1.06-1.06L8.53 4.72z",fill:"currentColor"}],edit:[{d:"M13.416 2.584c.778.778.778 2.039 0 2.817L6.058 12.76c-.319.32-.719.546-1.156.655l-2.283.57a.498.498 0 0 1-.604-.603l.57-2.283a2.49 2.49 0 0 1 .656-1.156l7.358-7.358a1.992 1.992 0 0 1 2.817 0zM9.894 4.697l-5.949 5.949a1.495 1.495 0 0 0-.393.694l-.369 1.477l1.477-.37c.263-.065.503-.2.694-.392l5.949-5.95l-1.409-1.408zm1.41-1.41l-.705.705l1.408 1.409l.705-.704a.996.996 0 0 0-1.409-1.41z",fill:"currentColor"}]};a(1701);var E={props:{size:{type:[Number,String],default:20},color:{type:String,default:"currentColor"},viewBox:{type:String,default:"0 0 16 16"},paths:{type:Array,required:!0}},setup(e){return()=>(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:e.viewBox,fill:e.color,width:e.size,height:e.size,"aria-hidden":"true",focusable:"false"},e.paths.map(e=>(0,n.h)("path",e)))}};const z=E;var L=z;const O={class:"tool-panel"};var U=(0,n.pM)({__name:"ToolPanel",props:{elements:{type:Array,default:()=>[]},isRunning:Boolean,isStopped:Boolean,selectedNode:Object,selectedEdge:Object},emits:["add-node","start-flow","stop-flow","continue-flow","reset-flow","update-node-label","update-node-command","delete-selected-edge","import-json"],setup(e,{emit:l}){const{getEdges:a}=(0,u.Id)(),t=(0,s.J)(),r=(0,o.KR)(null),i=e=>{const l=C?.[e];return l?(0,n.h)(L,{paths:l}):null},w=i("question"),A=i("plus"),E=i("play"),z=i("pause"),U=i("delete"),M=i("refresh"),W=i("code"),K=i("download"),j=i("upload"),X=i("edit"),N=e,S=l,B=(0,o.KR)("my_flow"),$=(0,o.KR)("My flow's description"),I=(0,o.KR)(""),P=(0,o.KR)(""),V=(0,o.KR)(!1),T=(0,o.KR)(!1),Q=(0,o.KR)(!1),J=(0,n.EW)(()=>{const e=new Set;let l="start";while(l&&"end"!==l){if(e.has(l))return!1;e.add(l);const t=a.value.filter(e=>e.source===l);if(1!==t.length)return!1;l=t[0].target}return"end"===l}),D=e=>{const l=N.elements.filter(l=>l.source===e&&l.target);return l.length>0?l[0].target:null},H=()=>{const e=[];let l="start";while("end"!==l){const a=D(l);if(!a||"end"===a)break;const t=N.elements.find(e=>e.id===a);t&&!ae(t.id)&&e.push({name:t.data.label,command:t.data.command}),l=a}const a={name:B.value,description:$.value,steps:e};I.value=F().stringify(a)},q=()=>{const e=[];let l="start";while("end"!==l){const a=D(l);if(!a||"end"===a)break;const t=N.elements.find(e=>e.id===a);if(t&&!ae(t.id)){const l={name:t.data.label,command:t.data.command,type:t.data.label.split("_")[0]},a=t.data.label.split("_")[0],n=t.data.label.split("_")[1],o=x[a]?.find(e=>e.name===n);o&&(l.params={},o.params.forEach(e=>{void 0!==t.data[e.name]&&(l.params[e.name]=t.data[e.name])})),e.push(l)}l=a}const a={name:B.value,description:$.value,steps:e};P.value=JSON.stringify(a,null,2)},Y=()=>{if(!I.value)return;const e=new Blob([I.value],{type:"application/yaml"}),l=URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=`${B.value}.yaml`.replace(/\s+/g,"_"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l)},G=()=>{if(!P.value)return;const e=new Blob([P.value],{type:"application/json"}),l=URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=`${B.value}.json`.replace(/\s+/g,"_"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l)},Z=()=>{r.value?.click()},ee=async e=>{const l=e.target;if(!l.files||0===l.files.length)return;const a=l.files[0];if(a)try{const e=await le(a),l=JSON.parse(e);if(!l||"object"!==typeof l)throw new Error("Invalid JSON format");B.value=l.name||"imported_flow",$.value=l.description||"",S("import-json",l),t.success("Flow импортирован успешно")}catch(n){t.error(`Import failed: ${n instanceof Error?n.message:"Unknown error"}`),console.error("Import error:",n)}finally{l&&(l.value="")}},le=e=>new Promise((l,a)=>{const t=new FileReader;t.onload=()=>l(t.result),t.onerror=()=>a(new Error("File reading failed")),t.readAsText(e)}),ae=e=>"start"===e||"end"===e;return(e,l)=>((0,n.uX)(),(0,n.CE)("div",O,[(0,n.bF)((0,o.R1)(c.A),{justify:"space-between",align:"center",style:{padding:"7px 17px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(c.A),{style:{padding:"0 17px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),{style:{color:"#f2f2f2","font-size":"20px"},strong:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,d.v_)(B.value),1)]),_:1}),(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click"},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{text:"",style:{"font-size":"18px"},color:"#c7c7c7"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(X))]),_:1})]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(b.Ay),{title:"Настройки пайплайна",size:"small",style:{width:"300px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(y.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(g.Ay),{label:"Название",path:"flowName"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:B.value,"onUpdate:value":l[0]||(l[0]=e=>B.value=e),placeholder:"Введите название"},null,8,["value"])]),_:1}),(0,n.bF)((0,o.R1)(g.Ay),{label:"Описание",path:"flowDescription"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:$.value,"onUpdate:value":l[1]||(l[1]=e=>$.value=e),placeholder:"Введите описание",type:"textarea"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),(0,n.bF)((0,o.R1)(c.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[2]||(l[2]=l=>e.$emit("add-node")),type:"primary",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(A))]),_:1})]),_:1}),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[3]||(l[3]=l=>e.$emit("start-flow")),disabled:!J.value||N.isRunning,type:"success",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(E))]),_:1})]),_:1},8,["disabled"]),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[4]||(l[4]=l=>e.$emit("stop-flow")),disabled:!N.isRunning||N.isStopped,type:"warning",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(z))]),_:1})]),_:1},8,["disabled"]),N.isStopped?((0,n.uX)(),(0,n.Wv)((0,o.R1)(f.Ay),{key:0,onClick:l[5]||(l[5]=l=>e.$emit("reset-flow")),type:"error",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(M))]),_:1})]),_:1})):(0,n.Q3)("",!0)]),_:1}),N.selectedEdge?((0,n.uX)(),(0,n.Wv)((0,o.R1)(c.A),{key:0},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[6]||(l[6]=l=>e.$emit("delete-selected-edge")),type:"error",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(U))]),_:1})]),_:1})]),_:1})):(0,n.Q3)("",!0),(0,n.bF)((0,o.R1)(c.A),null,{default:(0,n.k6)(()=>[J.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click",show:T.value},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[7]||(l[7]=e=>{H(),T.value=!T.value}),ghost:"",color:"#c7c7c7",size:"small"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(W))]),_:1})]),default:(0,n.k6)(()=>[l[13]||(l[13]=(0,n.eW)(" YAML "))]),_:1,__:[13]})]),default:(0,n.k6)(()=>[I.value?((0,n.uX)(),(0,n.Wv)((0,o.R1)(b.Ay),{key:0,title:"DAGU Config",size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(k.A),{language:"yaml",code:I.value,"word-wrap":""},null,8,["code"])]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["show"]),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[8]||(l[8]=e=>Y()),size:"small",ghost:"",color:"#c7c7c7"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(K))]),_:1})]),default:(0,n.k6)(()=>[l[14]||(l[14]=(0,n.eW)(" Export YAML "))]),_:1,__:[14]}),(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click",show:V.value},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[9]||(l[9]=e=>{q(),V.value=!V.value}),ghost:"",color:"#c7c7c7",size:"small"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(W))]),_:1})]),default:(0,n.k6)(()=>[l[15]||(l[15]=(0,n.eW)(" JSON "))]),_:1,__:[15]})]),default:(0,n.k6)(()=>[P.value?((0,n.uX)(),(0,n.Wv)((0,o.R1)(b.Ay),{key:0,title:"Конфигурация JSON",size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(k.A),{language:"json",code:P.value,"word-wrap":""},null,8,["code"])]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["show"]),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[10]||(l[10]=e=>G()),size:"small",ghost:"",color:"#c7c7c7"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(K))]),_:1})]),default:(0,n.k6)(()=>[l[16]||(l[16]=(0,n.eW)(" Export JSON "))]),_:1,__:[16]})],64)):(0,n.Q3)("",!0),(0,n.Lk)("input",{type:"file",ref_key:"fileInput",ref:r,accept:".json",style:{display:"none"},onChange:ee},null,544),(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[11]||(l[11]=e=>Z()),ghost:"",color:"#c7c7c7",size:"small"},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(j))]),_:1})]),default:(0,n.k6)(()=>[l[17]||(l[17]=(0,n.eW)(" Import JSON "))]),_:1,__:[17]})]),_:1}),(0,n.bF)((0,o.R1)(c.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(v.Ay),{trigger:"click",show:Q.value},{trigger:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(f.Ay),{onClick:l[12]||(l[12]=e=>Q.value=!Q.value),ghost:"",color:"#c7c7c7",circle:""},{icon:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(m._),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(w))]),_:1})]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(_.Ay),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[18]||(l[18]=[(0,n.Lk)("strong",null,"ЛКМ",-1),(0,n.eW)(" - Выбрать шаг")])),_:1,__:[18]})]),_:1}),(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[19]||(l[19]=[(0,n.Lk)("strong",null,"ПКМ",-1),(0,n.eW)(" - Редактировать параметры шага")])),_:1,__:[19]})]),_:1}),(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[20]||(l[20]=[(0,n.Lk)("strong",null,"Ctrl+A",-1),(0,n.eW)(" - Добавить новый шаг")])),_:1,__:[20]})]),_:1}),(0,n.bF)((0,o.R1)(R.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(p.A),null,{default:(0,n.k6)(()=>l[21]||(l[21]=[(0,n.Lk)("strong",null,"Ctrl+X",-1),(0,n.eW)(" - Удалить выбранный шаг или связь")])),_:1,__:[21]})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1})]))}}),M=a(1241);const W=(0,M.A)(U,[["__scopeId","data-v-2cef7888"]]);var K=W,j=a(9542),X=a(8898),N=a(9190);const S={style:{display:"flex","justify-content":"flex-end","margin-top":"20px"}};var B=(0,n.pM)({__name:"NodeContextMenu",props:{node:{type:Object,required:!0},visible:Boolean,x:Number,y:Number},emits:["update:visible","update-label","update-command","update-params"],setup(e,{emit:l}){const a=e,t=l,u=(0,o.KR)(""),r=(0,o.KR)(""),i=(0,o.KR)({}),s=(0,n.EW)(()=>{if(!a.node?.data?.label)return[];const[e,l]=a.node.data.label.split("_"),t=x[e],n=t?.find(e=>e.name===l);return n?n.params:[]});(0,n.wB)(()=>a.node,e=>{e&&(u.value=e.data.label,r.value=e.data.command||"",s.value.forEach(l=>{i.value[l.name]=void 0!==e.data[l.name]?e.data[l.name]:l.default}))},{immediate:!0});const c=(0,n.EW)(()=>({left:`${a.x}px`,top:`${a.y}px`,position:"absolute",zIndex:1e3})),p=()=>{t("update-label",u.value),t("update-command",r.value);const e={};s.value.forEach(l=>{void 0!==i.value[l.name]&&(e[l.name]=i.value[l.name])}),t("update-params",e),t("update:visible",!1)};return(l,a)=>e.visible?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"node-context-menu",style:(0,d.Tr)(c.value)},[(0,n.bF)((0,o.R1)(b.Ay),{title:"Редактирование шага",size:"small",style:{width:"350px"}},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(y.A),null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(g.Ay),{label:"Название шага"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:u.value,"onUpdate:value":a[0]||(a[0]=e=>u.value=e),onBlur:l.updateLabel},null,8,["value","onBlur"])]),_:1}),(0,n.bF)((0,o.R1)(g.Ay),{label:"Команда"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(h.A),{value:r.value,"onUpdate:value":a[1]||(a[1]=e=>r.value=e),onBlur:l.updateCommand},null,8,["value","onBlur"])]),_:1}),s.value.length>0?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(s.value,e=>((0,n.uX)(),(0,n.Wv)((0,o.R1)(g.Ay),{key:e.name,label:e.name},{default:(0,n.k6)(()=>["string"===e.type&&e.enum?((0,n.uX)(),(0,n.Wv)((0,o.R1)(j.A),{key:0,value:i.value[e.name],"onUpdate:value":l=>i.value[e.name]=l,options:e.enum.map(e=>({label:e,value:e}))},null,8,["value","onUpdate:value","options"])):"string"===e.type?((0,n.uX)(),(0,n.Wv)((0,o.R1)(h.A),{key:1,value:i.value[e.name],"onUpdate:value":l=>i.value[e.name]=l},null,8,["value","onUpdate:value"])):"boolean"===e.type?((0,n.uX)(),(0,n.Wv)((0,o.R1)(X.A),{key:2,value:i.value[e.name],"onUpdate:value":l=>i.value[e.name]=l},null,8,["value","onUpdate:value"])):"number"===e.type?((0,n.uX)(),(0,n.Wv)((0,o.R1)(N.A),{key:3,value:i.value[e.name],"onUpdate:value":l=>i.value[e.name]=l},null,8,["value","onUpdate:value"])):(0,n.Q3)("",!0)]),_:2},1032,["label"]))),128)):(0,n.Q3)("",!0),(0,n.Lk)("div",S,[(0,n.bF)((0,o.R1)(f.Ay),{onClick:p,type:"primary"},{default:(0,n.k6)(()=>a[2]||(a[2]=[(0,n.eW)(" Сохранить ")])),_:1,__:[2]})])]),_:1})]),_:1})],4)):(0,n.Q3)("",!0)}});const $=(0,M.A)(B,[["__scopeId","data-v-28e50b78"]]);var I=$,P=a(9200),V=(0,n.pM)({__name:"NodeSelectionMenu",props:{show:Boolean,position:{type:Object,default:()=>({x:0,y:0})}},emits:["select","update:show"],setup(e,{emit:l}){const a=e,t=l,u=(0,n.EW)({get:()=>a.show,set:e=>t("update:show",e)}),r=(0,n.EW)(()=>{const e=[];for(const[l,a]of Object.entries(x))e.push({type:"group",label:l.toUpperCase(),key:l,children:a.map(e=>({label:`${l}_${e.name}`,key:`${l}_${e.name}`,nodeData:e}))});return e}),i=(e,l)=>{t("select",{label:e,params:l.nodeData.params}),u.value=!1};return(l,a)=>((0,n.uX)(),(0,n.Wv)((0,o.R1)(P.A),{show:u.value,"onUpdate:show":a[0]||(a[0]=e=>u.value=e),options:r.value,x:e.position.x,y:e.position.y,placement:"bottom-start",trigger:"manual",onSelect:i},{default:(0,n.k6)(()=>a[1]||(a[1]=[(0,n.Lk)("div",{style:{position:"absolute",left:"-9999px"}},null,-1)])),_:1,__:[1]},8,["show","options","x","y"]))}});const T=V;var Q=T,J=(0,n.pM)({__name:"FlowBuilder",setup(e){const l=(0,o.KR)([{id:"start",type:"input",data:{label:"start",command:"",processFunction:async()=>{console.log("start"),await z(1e3)}},position:{x:50,y:50},sourcePosition:u.yX.Bottom,style:{backgroundColor:"#d0d0d0",color:"black",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1},{id:"end",type:"output",data:{label:"end",command:"",processFunction:async()=>{console.log("end"),await z(1e3)}},position:{x:500,y:400},sourcePosition:u.yX.Top,style:{backgroundColor:"#454545",color:"white",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1}]),{removeEdges:a,addNodes:t,updateNode:d,removeNodes:s,getEdges:c,setNodes:p,setEdges:v,fitView:f}=(0,u.Id)(),m=(0,o.KR)(!1),b=(0,o.KR)(!1),y=(0,o.KR)(null),g=(0,o.KR)(null),h=(0,o.KR)(null),k=(0,o.KR)(!1),_=(0,o.KR)(null),R=(0,o.KR)(null),w=(0,o.KR)(!1),F=(0,o.KR)({x:0,y:0}),A=(0,o.KR)(!1),C=(0,o.KR)({x:0,y:0}),E=(0,n.EW)(()=>{let e=0,l="start";while("end"!==l){const a=ne(l);if(!a||"end"===a)break;e++,l=a}return e}),z=e=>new Promise(l=>setTimeout(l,e)),L=e=>"start"===e||"end"===e,O=e=>"input"===e.type?"input-node":"output"===e.type?"output-node":"default-node",U=({pane:e})=>{e&&(e.tabIndex=0,e.focus())},M=e=>{!e.ctrlKey&&!e.metaKey||"x"!==e.key&&"ч"!==e.key||(e.preventDefault(),W(),q()),!e.ctrlKey&&!e.metaKey||"a"!==e.key&&"ф"!==e.key||(e.preventDefault(),j())},W=()=>{if(!g.value||L(g.value.id))return void console.warn("Нет выбранной ноды для удаления или нода защищена");const e=g.value.id,t=c.value.filter(l=>l.source===e||l.target===e);t.length>0&&a(t),s([e]),l.value=l.value.filter(l=>l.id!==e&&!t.some(e=>e.id===l.id)),g.value=null,T(),Y()},j=e=>{if(e)C.value={x:e.clientX,y:e.clientY};else{const e=window.innerWidth/2,l=window.innerHeight/2;C.value={x:e,y:l}}A.value=!0},X=e=>{const a=(0,r.A)(),n=e.params.reduce((e,l)=>(e[l.name]=void 0!==l.default?l.default:"",e),{}),o={id:a,data:{label:e.label,command:"",...n,processFunction:async()=>{console.log(`Выполняется шаг ${a}`),await z(1e3)}},position:{x:100+100*E.value,y:150},targetPosition:u.yX.Top,sourcePosition:u.yX.Bottom,style:{backgroundColor:"#2196F3",color:"white",borderRadius:"50%",width:"80px",height:"80px"}};l.value.push(o),t([o]),A.value=!1},N=e=>{const a={id:`edge-${e.source}-${e.target}`,source:e.source,target:e.target};l.value=(0,u.rN)(a,l.value),k.value=!1,Y()},S=e=>{if(!k.value){if(L(e.node.id))return g.value=null,h.value=null,void T();g.value=e.node,h.value=null,T()}},B=e=>{g.value=null,h.value=e.edge,T()},$=(e,l)=>{console.log("onUpdateEdge",l)},P=e=>{if(!e?.node||L(e.node.id))return;e.event.preventDefault(),g.value=e.node,R.value=e.node;const l=_.value?.getBoundingClientRect();l&&(F.value={x:e.event.clientX-l.left,y:e.event.clientY-l.top},w.value=!0)},V=()=>{T()},T=()=>{R.value=null},J=e=>{if(g.value&&!L(g.value.id)){const a=l.value.findIndex(e=>e.id===g.value?.id);-1!==a&&(l.value[a].data.label=e,d(g.value.id,l.value[a]))}},D=e=>{if(g.value&&!L(g.value.id)){const a=l.value.findIndex(e=>e.id===g.value?.id);-1!==a&&(l.value[a].data.command=e,d(g.value.id,l.value[a]))}},H=e=>{if(g.value){const a=l.value.findIndex(e=>e.id===g.value?.id);if(-1!==a){const t=l.value[a];Object.keys(e).forEach(l=>{t.data[l]=e[l]}),d(t.id,t)}}},q=()=>{h.value&&(a([h.value]),l.value=l.value.filter(e=>e.id!==h.value?.id),h.value=null,Y())},Y=()=>{let e="start";while("end"!==e){const a=ne(e);if(!a||"end"===a)break;const t=l.value.find(e=>e.id===a);t&&!L(t.id)&&d(t.id,t),e=a}},G=e=>{try{if(!e?.steps||!Array.isArray(e.steps))throw new Error("Invalid configuration: missing steps array");const a=[],t=[];let o=50;const i=150;if(a.push({id:"start",type:"input",data:{label:"start",command:"",processFunction:async()=>await z(1e3)},position:{x:o,y:50},sourcePosition:u.yX.Bottom,style:{backgroundColor:"#d0d0d0",color:"black",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1}),o+=200,e.steps.forEach(e=>{const l=(0,r.A)(),[n,d]=e.name.split("_"),s={label:e.name,command:e.command||"",processFunction:async()=>await z(1e3)},c=x[n]?.find(e=>e.name===d);if(c&&c.params.forEach(l=>{s[l.name]=e.params?.[l.name]??l.default}),a.push({id:l,data:s,position:{x:o,y:i},targetPosition:u.yX.Top,sourcePosition:u.yX.Bottom,style:{backgroundColor:"#2196F3",color:"white",borderRadius:"50%",width:"80px",height:"80px"},draggable:!0,selectable:!0,deletable:!0}),a.length>1){const e=a[a.length-2];t.push({id:`edge-${e.id}-${l}`,source:e.id,target:l})}o+=200}),a.push({id:"end",type:"output",data:{label:"end",command:"",processFunction:async()=>await z(1e3)},position:{x:o,y:50},sourcePosition:u.yX.Top,style:{backgroundColor:"#454545",color:"white",borderRadius:"10px",width:"120px",height:"60px"},draggable:!0,selectable:!0,deletable:!1}),a.length>2){const e=a[a.length-2];t.push({id:`edge-${e.id}-end`,source:e.id,target:"end"})}l.value=[...a,...t],p(a),v(t),(0,n.dY)(()=>f({padding:.5}))}catch(a){console.error("Graph import error:",a)}},Z=async()=>{m.value=!0,b.value=!1,y.value="start";try{await te("start");let e=ne("start");while(e&&m.value)y.value=e,await te(e),e=ne(e);m.value&&(y.value="end",await te("end"))}catch(e){console.error("Ошибка выполнения графа:",e)}finally{m.value=!1,y.value=null}},ee=()=>{m.value=!1,b.value=!0},le=async()=>{if(y.value){b.value=!1,m.value=!0;try{let e=ne(y.value);while(e&&m.value)y.value=e,await te(e),e=ne(e);m.value&&(y.value="end",await te("end"))}catch(e){console.error("Ошибка выполнения графа:",e)}finally{m.value=!1,b.value=!1,y.value=null}}},ae=()=>{m.value=!1,b.value=!1,y.value=null},te=async e=>{const a=l.value.find(l=>l.id===e);a?.data?.processFunction&&await a.data.processFunction()},ne=e=>{const a=l.value.filter(l=>l.source===e&&l.target);return a.length>0?a[0].target:null};return(0,n.sV)(()=>{_.value&&_.value.focus()}),(e,a)=>((0,n.uX)(),(0,n.CE)("div",{class:"flow-container",tabindex:"0",onKeydown:M},[(0,n.bF)((0,o.R1)(i.A),null,{default:(0,n.k6)(()=>[(0,n.bF)(K,{elements:l.value,"is-running":m.value,"is-stopped":b.value,"selected-node":g.value,"selected-edge":h.value,onAddNode:j,onStartFlow:Z,onStopFlow:ee,onContinueFlow:le,onResetFlow:ae,onUpdateNodeLabel:J,onUpdateNodeCommand:D,onDeleteSelectedEdge:q,onImportJson:G},null,8,["elements","is-running","is-stopped","selected-node","selected-edge"]),(0,n.Lk)("div",{class:"flow-wrapper",ref_key:"flowWrapper",ref:_},[(0,n.bF)((0,o.R1)(u.nO),{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),style:{width:"100%",height:"88vh",background:"#fcfcfc"},onNodeClick:S,onEdgeClick:B,onUpdateEdge:$,onNodeContextMenu:P,onPaneClick:V,"connection-mode":k.value,onConnect:N,onPaneReady:U,"node-class":O},null,8,["modelValue","connection-mode"]),w.value&&R.value?((0,n.uX)(),(0,n.Wv)(I,{key:0,node:R.value,visible:w.value,x:F.value.x,y:F.value.y,"onUpdate:visible":a[1]||(a[1]=e=>w.value=e),onUpdateLabel:J,onUpdateCommand:D,onUpdateParams:H},null,8,["node","visible","x","y"])):(0,n.Q3)("",!0),A.value?((0,n.uX)(),(0,n.Wv)(Q,{key:1,show:A.value,position:C.value,"onUpdate:show":a[2]||(a[2]=e=>A.value=e),onSelect:X},null,8,["show","position"])):(0,n.Q3)("",!0)],512)]),_:1})],32))}});const D=(0,M.A)(J,[["__scopeId","data-v-7c583e83"]]);var H=D,q=a(1418),Y=a(7494),G=(0,n.pM)({__name:"App",setup(e){return q.A.registerLanguage("javascript",Y.A),(e,l)=>{const a=(0,n.g2)("n-message-provider"),t=(0,n.g2)("n-config-provider");return(0,n.uX)(),(0,n.Wv)(t,{hljs:(0,o.R1)(q.A)},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)(H)]),_:1})]),_:1},8,["hljs"])}}});const Z=G;var ee=Z,le={beforeMount(e,l){e.clickOutsideEvent=function(a){e===a.target||e.contains(a.target)||l.value(a)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.body.removeEventListener("click",e.clickOutsideEvent)}},ae=a(2884);const te=(0,t.Ef)(ee);te.directive("click-outside",le),te.use(ae.A),te.mount("#app")}},l={};function a(t){var n=l[t];if(void 0!==n)return n.exports;var o=l[t]={exports:{}};return e[t].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(l,t,n,o){if(!t){var u=1/0;for(s=0;s<e.length;s++){t=e[s][0],n=e[s][1],o=e[s][2];for(var r=!0,i=0;i<t.length;i++)(!1&o||u>=o)&&Object.keys(a.O).every(function(e){return a.O[e](t[i])})?t.splice(i--,1):(r=!1,o<u&&(u=o));if(r){e.splice(s--,1);var d=n();void 0!==d&&(l=d)}}return l}o=o||0;for(var s=e.length;s>0&&e[s-1][2]>o;s--)e[s]=e[s-1];e[s]=[t,n,o]}}(),function(){a.n=function(e){var l=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(l,{a:l}),l}}(),function(){a.d=function(e,l){for(var t in l)a.o(l,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:l[t]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(l){return 0===e[l]};var l=function(l,t){var n,o,u=t[0],r=t[1],i=t[2],d=0;if(u.some(function(l){return 0!==e[l]})){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(i)var s=i(a)}for(l&&l(t);d<u.length;d++)o=u[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(s)},t=self["webpackChunkflow_builder"]=self["webpackChunkflow_builder"]||[];t.forEach(l.bind(null,0)),t.push=l.bind(null,t.push.bind(t))}();var t=a.O(void 0,[504],function(){return a(8051)});t=a.O(t)})();
//# sourceMappingURL=app.fa8df610.js.map